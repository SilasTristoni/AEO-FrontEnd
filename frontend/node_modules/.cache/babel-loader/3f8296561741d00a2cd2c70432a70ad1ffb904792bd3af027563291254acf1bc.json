{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\joao.garcia2\\\\Documents\\\\testeFront\\\\AEO-FrontEnd\\\\frontend\\\\src\\\\context\\\\AuthContext.js\",\n  _s = $RefreshSig$();\nimport React, { createContext, useState, useEffect, useCallback } from 'react';\nimport { jwtDecode } from 'jwt-decode';\nimport api from '../api/api';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nexport const AuthContext = /*#__PURE__*/createContext(null);\nexport const AuthProvider = ({\n  children\n}) => {\n  _s();\n  // Estado para os dados de autenticação\n  const [auth, setAuth] = useState({\n    token: null,\n    user: null\n  });\n  // Estado separado para o carregamento inicial\n  const [loading, setLoading] = useState(true);\n  const login = useCallback(token => {\n    try {\n      localStorage.setItem('token', token);\n      api.defaults.headers.common['Authorization'] = `Bearer ${token}`;\n      const decodedUser = jwtDecode(token);\n      // Atualiza o estado com o token e os dados do usuário decodificados\n      setAuth({\n        token: token,\n        user: decodedUser\n      });\n    } catch (error) {\n      console.error(\"Token inválido ou expirado.\", error);\n      logout(); // Se o token for inválido, limpa tudo\n    }\n  }, []);\n  const logout = () => {\n    localStorage.removeItem('token');\n    delete api.defaults.headers.common['Authorization'];\n    setAuth({\n      token: null,\n      user: null\n    });\n  };\n\n  // Efeito para verificar o token salvo no localStorage ao carregar a aplicação\n  useEffect(() => {\n    const token = localStorage.getItem('token');\n    if (token) {\n      login(token); // Tenta fazer o login com o token existente\n    }\n    setLoading(false); // Finaliza o carregamento inicial\n  }, [login]);\n\n  // O valor do provedor agora é um objeto com `auth`, `loading`, `login` e `logout`\n  const value = {\n    auth,\n    loading,\n    login,\n    logout\n  };\n\n  // Não renderiza os componentes filhos enquanto a verificação inicial não terminar\n  return /*#__PURE__*/_jsxDEV(AuthContext.Provider, {\n    value: value,\n    children: !loading && children\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 54,\n    columnNumber: 5\n  }, this);\n};\n_s(AuthProvider, \"apWYs3Bqy5n2JeNhDghhJbFeAFI=\");\n_c = AuthProvider;\nvar _c;\n$RefreshReg$(_c, \"AuthProvider\");","map":{"version":3,"names":["React","createContext","useState","useEffect","useCallback","jwtDecode","api","jsxDEV","_jsxDEV","AuthContext","AuthProvider","children","_s","auth","setAuth","token","user","loading","setLoading","login","localStorage","setItem","defaults","headers","common","decodedUser","error","console","logout","removeItem","getItem","value","Provider","fileName","_jsxFileName","lineNumber","columnNumber","_c","$RefreshReg$"],"sources":["C:/Users/joao.garcia2/Documents/testeFront/AEO-FrontEnd/frontend/src/context/AuthContext.js"],"sourcesContent":["import React, { createContext, useState, useEffect, useCallback } from 'react';\r\nimport { jwtDecode } from 'jwt-decode';\r\nimport api from '../api/api';\r\n\r\nexport const AuthContext = createContext(null);\r\n\r\nexport const AuthProvider = ({ children }) => {\r\n  // Estado para os dados de autenticação\r\n  const [auth, setAuth] = useState({ token: null, user: null });\r\n  // Estado separado para o carregamento inicial\r\n  const [loading, setLoading] = useState(true);\r\n\r\n  const login = useCallback((token) => {\r\n    try {\r\n      localStorage.setItem('token', token);\r\n      api.defaults.headers.common['Authorization'] = `Bearer ${token}`;\r\n      const decodedUser = jwtDecode(token);\r\n      // Atualiza o estado com o token e os dados do usuário decodificados\r\n      setAuth({\r\n        token: token,\r\n        user: decodedUser,\r\n      });\r\n    } catch (error) {\r\n      console.error(\"Token inválido ou expirado.\", error);\r\n      logout(); // Se o token for inválido, limpa tudo\r\n    }\r\n  }, []);\r\n\r\n  const logout = () => {\r\n    localStorage.removeItem('token');\r\n    delete api.defaults.headers.common['Authorization'];\r\n    setAuth({ token: null, user: null });\r\n  };\r\n\r\n  // Efeito para verificar o token salvo no localStorage ao carregar a aplicação\r\n  useEffect(() => {\r\n    const token = localStorage.getItem('token');\r\n    if (token) {\r\n      login(token); // Tenta fazer o login com o token existente\r\n    }\r\n    setLoading(false); // Finaliza o carregamento inicial\r\n  }, [login]);\r\n\r\n  // O valor do provedor agora é um objeto com `auth`, `loading`, `login` e `logout`\r\n  const value = {\r\n    auth,\r\n    loading,\r\n    login,\r\n    logout\r\n  };\r\n\r\n  // Não renderiza os componentes filhos enquanto a verificação inicial não terminar\r\n  return (\r\n    <AuthContext.Provider value={value}>\r\n      {!loading && children}\r\n    </AuthContext.Provider>\r\n  );\r\n};"],"mappings":";;AAAA,OAAOA,KAAK,IAAIC,aAAa,EAAEC,QAAQ,EAAEC,SAAS,EAAEC,WAAW,QAAQ,OAAO;AAC9E,SAASC,SAAS,QAAQ,YAAY;AACtC,OAAOC,GAAG,MAAM,YAAY;AAAC,SAAAC,MAAA,IAAAC,OAAA;AAE7B,OAAO,MAAMC,WAAW,gBAAGR,aAAa,CAAC,IAAI,CAAC;AAE9C,OAAO,MAAMS,YAAY,GAAGA,CAAC;EAAEC;AAAS,CAAC,KAAK;EAAAC,EAAA;EAC5C;EACA,MAAM,CAACC,IAAI,EAAEC,OAAO,CAAC,GAAGZ,QAAQ,CAAC;IAAEa,KAAK,EAAE,IAAI;IAAEC,IAAI,EAAE;EAAK,CAAC,CAAC;EAC7D;EACA,MAAM,CAACC,OAAO,EAAEC,UAAU,CAAC,GAAGhB,QAAQ,CAAC,IAAI,CAAC;EAE5C,MAAMiB,KAAK,GAAGf,WAAW,CAAEW,KAAK,IAAK;IACnC,IAAI;MACFK,YAAY,CAACC,OAAO,CAAC,OAAO,EAAEN,KAAK,CAAC;MACpCT,GAAG,CAACgB,QAAQ,CAACC,OAAO,CAACC,MAAM,CAAC,eAAe,CAAC,GAAG,UAAUT,KAAK,EAAE;MAChE,MAAMU,WAAW,GAAGpB,SAAS,CAACU,KAAK,CAAC;MACpC;MACAD,OAAO,CAAC;QACNC,KAAK,EAAEA,KAAK;QACZC,IAAI,EAAES;MACR,CAAC,CAAC;IACJ,CAAC,CAAC,OAAOC,KAAK,EAAE;MACdC,OAAO,CAACD,KAAK,CAAC,6BAA6B,EAAEA,KAAK,CAAC;MACnDE,MAAM,CAAC,CAAC,CAAC,CAAC;IACZ;EACF,CAAC,EAAE,EAAE,CAAC;EAEN,MAAMA,MAAM,GAAGA,CAAA,KAAM;IACnBR,YAAY,CAACS,UAAU,CAAC,OAAO,CAAC;IAChC,OAAOvB,GAAG,CAACgB,QAAQ,CAACC,OAAO,CAACC,MAAM,CAAC,eAAe,CAAC;IACnDV,OAAO,CAAC;MAAEC,KAAK,EAAE,IAAI;MAAEC,IAAI,EAAE;IAAK,CAAC,CAAC;EACtC,CAAC;;EAED;EACAb,SAAS,CAAC,MAAM;IACd,MAAMY,KAAK,GAAGK,YAAY,CAACU,OAAO,CAAC,OAAO,CAAC;IAC3C,IAAIf,KAAK,EAAE;MACTI,KAAK,CAACJ,KAAK,CAAC,CAAC,CAAC;IAChB;IACAG,UAAU,CAAC,KAAK,CAAC,CAAC,CAAC;EACrB,CAAC,EAAE,CAACC,KAAK,CAAC,CAAC;;EAEX;EACA,MAAMY,KAAK,GAAG;IACZlB,IAAI;IACJI,OAAO;IACPE,KAAK;IACLS;EACF,CAAC;;EAED;EACA,oBACEpB,OAAA,CAACC,WAAW,CAACuB,QAAQ;IAACD,KAAK,EAAEA,KAAM;IAAApB,QAAA,EAChC,CAACM,OAAO,IAAIN;EAAQ;IAAAsB,QAAA,EAAAC,YAAA;IAAAC,UAAA;IAAAC,YAAA;EAAA,OACD,CAAC;AAE3B,CAAC;AAACxB,EAAA,CAnDWF,YAAY;AAAA2B,EAAA,GAAZ3B,YAAY;AAAA,IAAA2B,EAAA;AAAAC,YAAA,CAAAD,EAAA","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}